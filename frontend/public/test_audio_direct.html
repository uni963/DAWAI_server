<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        .warning { background-color: #fff3cd; }
    </style>
</head>
<body>
    <h1>ğŸ” éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ</h1>
    <p>å•é¡Œã®ã‚ã‚‹ãƒ”ã‚¢ãƒã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›´æ¥URLç¢ºèª</p>

    <div id="results"></div>
    <button onclick="runTests()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>

    <script>
        const problemFiles = [
            'Piano MF G#4(R).wav',
            'Piano MF C#5(R).wav',
            'Piano MF D#5(R).wav'
        ];

        const workingFiles = [
            'Piano MF G#4(L).wav',
            'Piano MF C#5(L).wav',
            'Piano MF D#5(L).wav'
        ];

        async function testFile(filename) {
            const baseUrl = '/sounds/MuseScore_General/samples/piano/';
            const encodedUrl = baseUrl + encodeURIComponent(filename);
            const directUrl = baseUrl + filename;

            const result = {
                filename: filename,
                encodedUrl: encodedUrl,
                directUrl: directUrl,
                encodedStatus: null,
                directStatus: null,
                encodedContentType: null,
                directContentType: null,
                encodedSize: null,
                directSize: null
            };

            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸURL
            try {
                const response1 = await fetch(encodedUrl);
                result.encodedStatus = response1.status;
                result.encodedContentType = response1.headers.get('content-type');
                result.encodedSize = response1.headers.get('content-length');
                console.log(`ğŸ” [ENCODED] ${filename} -> Status: ${response1.status}, Type: ${result.encodedContentType}, Size: ${result.encodedSize}`);
            } catch (error) {
                result.encodedStatus = `Error: ${error.message}`;
                console.error(`âŒ [ENCODED] ${filename} -> ${error.message}`);
            }

            // ç›´æ¥URL
            try {
                const response2 = await fetch(directUrl);
                result.directStatus = response2.status;
                result.directContentType = response2.headers.get('content-type');
                result.directSize = response2.headers.get('content-length');
                console.log(`ğŸ” [DIRECT] ${filename} -> Status: ${response2.status}, Type: ${result.directContentType}, Size: ${result.directSize}`);
            } catch (error) {
                result.directStatus = `Error: ${error.message}`;
                console.error(`âŒ [DIRECT] ${filename} -> ${error.message}`);
            }

            return result;
        }

        async function runTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</p>';

            console.log('ğŸ¹ [AUDIO_TEST] =================================');
            console.log('ğŸ¹ [AUDIO_TEST] éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹');
            console.log('ğŸ¹ [AUDIO_TEST] =================================');

            const allFiles = [...problemFiles, ...workingFiles];
            const results = [];

            for (const file of allFiles) {
                const result = await testFile(file);
                results.push(result);
            }

            // çµæœè¡¨ç¤º
            let html = '<h2>ãƒ†ã‚¹ãƒˆçµæœ</h2>';

            html += '<h3>âŒ å•é¡Œã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«</h3>';
            problemFiles.forEach(file => {
                const result = results.find(r => r.filename === file);
                const cssClass = (result.encodedStatus === 200 && result.encodedContentType?.includes('audio')) ? 'success' : 'error';
                html += `<div class="test-result ${cssClass}">
                    <strong>${file}</strong><br>
                    ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ URL: ${result.encodedStatus} | ${result.encodedContentType} | ${result.encodedSize} bytes<br>
                    ç›´æ¥ URL: ${result.directStatus} | ${result.directContentType} | ${result.directSize} bytes<br>
                    <small>ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰: ${result.encodedUrl}</small><br>
                    <small>ç›´æ¥: ${result.directUrl}</small>
                </div>`;
            });

            html += '<h3>âœ… æ­£å¸¸ãªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ¯”è¼ƒç”¨ï¼‰</h3>';
            workingFiles.forEach(file => {
                const result = results.find(r => r.filename === file);
                const cssClass = (result.encodedStatus === 200 && result.encodedContentType?.includes('audio')) ? 'success' : 'warning';
                html += `<div class="test-result ${cssClass}">
                    <strong>${file}</strong><br>
                    ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ URL: ${result.encodedStatus} | ${result.encodedContentType} | ${result.encodedSize} bytes<br>
                    ç›´æ¥ URL: ${result.directStatus} | ${result.directContentType} | ${result.directSize} bytes
                </div>`;
            });

            resultsDiv.innerHTML = html;

            console.log('ğŸ¹ [AUDIO_TEST] =================================');
            console.log('ğŸ¹ [AUDIO_TEST] ãƒ†ã‚¹ãƒˆå®Œäº† - çµæœã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª');
            console.log('ğŸ¹ [AUDIO_TEST] =================================');
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚‚ç¢ºèª
        window.addEventListener('load', () => {
            console.log('ğŸ¹ [AUDIO_TEST] ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            console.log('ğŸ¹ [AUDIO_TEST] ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:5173/test_audio_direct.html ã«ã‚¢ã‚¯ã‚»ã‚¹');
            console.log('ğŸ¹ [AUDIO_TEST] ã€Œãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
        });
    </script>
</body>
</html>